---
title: "DSSS - Homework 2 (HW2) and Final Exam"
author: "Reinhold Kliegl"
date: "2022-03-19 (updated: `r Sys.time()`)"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: 2
    toc_float: no
    code_folding: show
editor_options: 
  chunk_output_type: console
---

# Part 1: Setup   

Deadline for turning in this script is midnight of **3 April 2022 (Moscow time)**. You can earn a maximum of 50 points (10 HW2, 40 Final Exam). 

This script assumes that this file is in the folder `DSSS` that you cloned or pulled from https://github.com/kliegl/DSSS 

1. Rename this file into **YourLastName_DSSS_HW2.Rmd**
2. Change the author name in the YAML header to your name.
3. Change the date in the YAML header to the current date. 
4. Fill the empty R chunks with code as spelled out in the tasks above them. 
5. Knit the file. Does it generate an HTML file? 
    + No: Fix the error. If necessary, ask for help.
    + Yes: Submit the Rmd file via email to reinhold.kliegl@uni-potsdam.de or via the zoomApp. 

Good luck!

**Setup**

```{r}
library(MASS)
library(car)
library(tidyverse)
library(performance)
```


# Part 2: Background

We will use data from the SAFI (Studying African Farmer-Led Irrigation) project which is looking at farming and irrigation methods. This is survey data relating to households and agriculture in Tanzania and Mozambique. The survey data was collected through interviews conducted between November 2016 and June 2017 using forms downloaded to Android Smartphones. The survey forms were created using the ODK (Open Data Kit) software via an Excel spreadsheet. The collected data is then sent back to a central server. The server can be used to download the collected data in both JSON and CSV formats.  This is not the full dataset.

We use the following variables

+ key_id:  a unique Id for each family
+ village:	Village name
+ no_membrs:	How many members in the household?
+ years_liv:  How many years have you been living in this village or neighboring village?
+ respondent_wall_type: What type of walls does their house have (from list)?
+ rooms: How many rooms in the main house are used for sleeping?
+ memb_assoc: Are you a member of an irrigation association?
+ affect_conflicts: Have you been affected by conflicts with other irrigators in the area?
+ liv_count: Livestock count
+ no_meals: How many meals do people in your household normally eat in a day?

6. Use the `read_csv()` command to read the file `SAFI_clean.csv`  from the subdirectory `data`  in this directory into an object `dat`. Select only the variables listed above.
7. Use the command `glimpse()` to inspect object `dat`. There are NULL values -- obviously these are missing data.  Change the `read_csv()` command so that NULL values are read as missing values (i.e., they apppear as NA). Hint type `?read_csv` in the console and find the argument to include. **Note**: The following tasks do not depend on finding a solution for this task. 
8. Insert commands that show the answers to the following questions. Enter the answers next to the questions:
   + How many rows and how many columns are there in `dat`?
   + How many villages are represented in `dat` and what are their names? 
   + What are the mean number of members in the family in each of the villages?
   + What are the corresponding standard deviations?
   
```{r}


```

# Part 3 - Dependent variable: Number of rooms

9. Rename the variable `key_ID` to `Family`
10. Convert the `character` variable `village` to the `factor` variable `Village`.
11. Order the levels of the factor `Village` such that the village with the largest number of families is the first level, the village with the second most number of families is the second level, and so on.

```{r}


```

12. Generate a graph plotting the number of rooms (y) over the number of members in a family (x) for with different colors for the villages (group). Use the `geom_jitter()` to avoid overplotting. 

```{r}

```

13. You will notice that there is one obvious outlier family. Exclude this outlier family with the `filter()` command and generate the plot again. In this plot also include linear regression lines for each village. 

14. Improve the aesthetics of the graph. 

```{r}

```

Judging by the last graph,

15. Carry out a multiple regression that tests whether the number of rooms increases with the size of the family and whether the increase is different for the villages. Use the factor `Village` (not the character variable `village`) and specify a treatment contrast for this factor.

16. Carry out three regression analysis and assign the output to `m1`, `m2`, and `m3`.

+  `m1`: Include only number of family member as independent variable
+  `m2`: Add the factor `Village` to  model `m1`
+  `m3`: add the interaction between no of family members and the Village factor to model `m2`.

17. Use the `anova()` to test whether there is an increment in goodness of fit when going from model `m1`to model `m2` to model `m3`.

18. Use the `check_model()` command from the package performance to inspect the diagnostic statistics for model residuals.

19. Based on your analysis, is there a significant relation between the size of the family and the number of rooms available to the family? 

20. Is there evidence for a significant difference between villages?

21. Is there evidence for the interaction of number of family members and villages?

22. Given the model residuals shown in the plot, is there reason for concern? If there is reason for concern, which of the plots suggests a violation of an assumption for model residuals? If so, moreover, which assumption appears to be violated?

23. Check the distribution of residuals with the `boxCox()` command.

24. Which transformation does the boxCox-check in task 23 suggest? 

**Please note:** You have to remove the outlier also for the multiple regression analysis. There are various ways to do this. For example, save the data without the outlier in a new object `dat2`. There is also a `subset` argument for the `lm()` command that allows you to select the data without the outlier. 

```{r}


```

# Part 4 - Dependent variable: Years lived in village or neighboring village

25. The variable `respondent_wall_type` codes the type of wall of the family's residence. How many different types of wall are there?

26. Collapse the wall type `cement` with the wall type `burntbricks` using the `fct_collapse()` in `mutate()`. Name the new level `solid` and the new factor `Wall`.

27. Compute the mean number of years lived in the region (`years_liv`) for each village and also the associated standard deviations and standard errors (SE). Store the results in an object `tbl_yearsl`. 

28. Generate a point and line graph based on `tbl_years` using `Village` on the x-axis and the mean number of years as dependent variable. The graph should also include errorbars covering +/- 2*SE from below to above the means. Improve the aesthetics of the graph.

**Note:** `Village` is the only independent variable in this graph. Therefore, there is no `color=` argument, but you must still specify `group=1`  to obtain a single line connecting the points.

29. Do you think there is a significant difference between two of the three villages? If yes, which ones? (You won't lose points here for a wrong answwer.)

```{r}



```

30. We can answer the above question with a multipe regression. Specify a suitable contrast to test your hypotheses with a multiple regression. Assign the results of the fitted object to `m4`.

31. Check the distributions of residuals with the `boxCox()` command. The results suggest a transformation.

```{r}

```

32. Transform the `years_liv`  according to the lambda returned in task 31 and repeat the mutliple regression and assign results to model `m5`. Does the profile of significance for the contrasts change? 

33. Check model residuals with the `check_model()` command.

+ Do the residuals look ok? 
+ Would you stop here or try something else?

```{r}

```

**That's it!**  

# Appendix

```{r}
sessionInfo()
```

