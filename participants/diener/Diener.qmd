---
title: "Jonathan Diener: Aliza"
author: "Reinhold Kliegl"
date: "2022-09-17 (last revised: `r format(Sys.time())`)"
format: 
  html:
    embed-resources: true
    toc: true
    toc-depth: 2
    number-sections: true
    fig-width: 8
    fig-height: 6
editor_options: 
  chunk_output_type: console
---

# Background

The aim of this study was to evaluate the acceptability and effectiveness of a chatbot in reducing sedentary behavior among university students. 

## Methods

The chatbot "Aliza" was developed in a human-centered design process. Subsequently, Aliza was evaluated in a pretest-posttest quasi-experimental pilot study involving German university students. Subjects interacted with Aliza, deployed on Slack Messenger, for two weeks. Each day, they were offered to schedule activity breaks. Aliza then reminded subjects of the breaks and sent them exercise challenges or videos. Acceptability was measured including usability, perceived enjoyment, and attitude toward using a chatbot to promote activity breaks. To evaluate effectiveness in terms of behavior change, daily activity breaks were assessed at baseline and during the first and second week of intervention.

## Main research questions

+	Will the developed chatbot demonstrate high acceptability among university students?
+	Will the usage of the chatbot lead to a significant increase in activity breaks compared to pre-intervention?

## Variables

+ Sozioökonomische Daten (Geschlecht, angestrebter Abschluss etc.)
+ Studiumsbezogene Daten (Lernort: Ort, an dem primär gelernt wird; Art der Lehre: Präsenz vs. Online, etc.)
+ Daten, die sich auf das Sitzverhalten und dessen Auswirkungen beziehen (Durchschnittliche Sitzzeit pro Tag, Gesundheitliche Auswirkungen durch das Sitzen, Anzahl Bewegungspausen vor der Intervention)
+ Akzeptanz des Chatbots (Usability: Chatbot Usability Score; perceived enjoyment, attitude toward using a chatbot, future usage intention) 
+ Während der Intervention erhobene Daten: Jeweils von Montag bis Freitag wurde die Anzahl an durchgeführten Bewegungspausen des Vortages abgefragt, montags für das vergangene Wochenende. Dabei wurden jeweils die nach Aufforderung von Aliza durchgeführten Bewegungspausen sowie die in Eigeninitiative ausgeführten Bewegungspausen abgefragt. Für jeden Tag gibt es somit zwei Variablen zu den Bewegungspausen. 
+ Daten zu den subjektiven Effekten der Bewegungspausen auf das physische und mentale Wohlbefinden sowie auf kognitive Aspekte (z.B. Konzentrationsfähigkeit)
+ Daten zu technischen Rahmenbedingungen (Endgerät, über das mit dem Chatbot kommuniziert wurde; Sind Push-Benachrichtigungen durchgekommen, etc.) 


# Preprocessing

## RK style guide

+ Random factors should be factors, not integers!
+ Factors capitalized, continuous variables in lower case
+ `Subj` instead of `ID`; prefix subject and item numbers with `S` and `I` 
+ Short variable names and factor levels, but respect tradeoff with mmemonic value
+ Labels should be of equal length
+ Hint: Leave out vowels in names and labels
+ See Jenny Bryan's [Naming Things](https://docplayer.net/55248970-Naming-things-prepared-by-jenny-bryan-for-reproducible-science-workshop.html)

## Packages

```{r}
library(easystats)
library(tidyverse)
library(haven)
library(labelled)
library(lme4)
library(summarytools)

# respecting color vision deficiency
cbPalette <- c( "#0072B2", "#D55E00", "#009E73", "#CC79A7",
                "#F0E442", "#56B4E9", "#999999", "#E69F00")
```

## Read and transform data

```{r}
#| eval=FALSE

dat_w <- 
   read_sav("DIENER.sav") |> 
   remove_labels() |> 
   select(Subj=1, Sex=2, 20, 31, 32, 33, 53, 47, 48, 49,
          w11= 8, w12= 9, w13=10, w14=11, w15=12, w16=13, 
          w21=56, w22=57, w23=58, w24=59, w25=60, w26=61) |> 
   mutate( Sex = factor(Sex, levels=1:2, labels=c("female", "male"))) 

stview(dfSummary(dat_w))

table(dat_w$Subj, dat_w$W1_Aliza_ingesamt)
```

A bit too complex for me...

+ Replacing one missing value in `preAtt` and two in `postAtt`

```{r}
dat_w <- 
   read_sav("DIENER.sav") |> 
   remove_labels() |> 
   select(Subj=1, Sex=2, Aliza1=31, preAtt=20, postAtt=53) |> 
   mutate( Subj = factor(Subj),
           Sex = factor(Sex, levels=1:2, labels=c("female", "male")),
           Group = factor(ifelse(is.na(Aliza1), "control", "treatment")),
           preAtt = ifelse(is.na(preAtt), 24, preAtt),
           postAtt = ifelse(is.na(postAtt), 25, postAtt)
   )

stview(dfSummary(dat_w))

```

From wide to long format

```{r}
dat <- 
  dat_w |> 
  pivot_longer(4:5, names_to = "PrePost",  names_transform = "as.factor",
               values_to = "attitude") |> 
  mutate(PrePost=fct_rev(PrePost))
```

Check need for transformation

```{r}
MASS::boxcox(attitude ~ 1 + Subj, data=dat)
```

Condition means

```{r}
dat |> 
  group_by(Group, PrePost) |> 
  summarise(N=n(), M=mean(attitude), SE=sd(attitude)/sqrt(N))
```

LMM

```{r}
contrasts(dat$Group) <- contr.sum(2)
contrasts(dat$PrePost) <- contr.sum(2)

m1 <-  lmer(attitude ~ 1  + Group*PrePost + (1 | Subj), data=dat, REML=FALSE,
            control=lmerControl(calc.derivs=FALSE))
print(summary(m1), corr=FALSE)
```

```{r}
contrasts(dat$Sex) <- contr.sum(2)

m2 <-  lmer(attitude ~ 1  + Group*PrePost*Sex + (1 | Subj), data=dat, REML=FALSE,
            control=lmerControl(calc.derivs=FALSE))
print(summary(m2), corr=FALSE)
```


# Appendix

```{r}
sessionInfo()
```
