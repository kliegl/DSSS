---
title: "Ethnic Violence: Preprocessing"
author: "Aleksandr Torkhov"
date: "2022-03-04 (updated: `r Sys.Date()`)"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: 2
    toc_float: no
    code_folding: hide
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Background

<Add five to ten sentences about the study and goals of analysis.>

# Setup

In this script we will use the command `tibble_transpose()`  which lives in the package `tblhelpr`. This package need to be installed from a non-default location. Therefore, before you run or knit this script you need to install the package `remotes` from the standard location and then use the command `install_github()` from the `remotes` package to install the package `tblhelpr` from a github repository. This can be achieved with the following two  two lines of commands:

```{r eval=FALSE}
install.packages("remotes")
remotes::install_github("allydunham/tblhelpr")
```

On my computer it is already installed. Therefore, I set "eval=FALSE" in the heading of the above chunk. This means when I knit the script, this chunk will not be evaluated. You can execute the chunk once or copy it into the Console. Much new development occurs on github. Therefore, this command will be useful to get the most recent versions of packages, that is before they are available on 

```{r}
library(tidyverse)
library(readxl)   # this package allows us to read xlsx files
library(tblhelpr)

library(summarytools) # dfSummary(), descr(), freq()
```

# Read and preprocess

I edited the submitted Excel spreadsheets to simplify their processing with R.  As long as you are not very proficient in R, it is probably more efficient to do it this way. 

The spreadsheet in the first file I separated into two sheets, because the first two lines appear to have different information than the rest of the lines. This also allows me to illustrate how to read data from an excel file with multiple sheets.

In the second file I only deleted a few lines at the beginning, including also the line containing the sum of values. These values can be computed within R because they are derived from the other values.

To simplify my life I replaced the Russian labels with the English ones provided in the R script. 

After reading the file, we transpose it. The final line merges the three files by year

```{r}
data_1a <- 
  read_xlsx("data/Torkhov_1_evt.xlsx", na="NA", sheet=1) |> 
  transpose_tibble(col_names=Year, id_col="Year") 

data_1b <- 
  read_xlsx("data/Torkhov_1_evt.xlsx", na="NA", sheet="Minority") |> 
  transpose_tibble(col_names=Year, id_col="Year")

data_2 <- 
  read_xlsx("data/Torkhov_2_excw.xlsx", na="NA") |> 
  transpose_tibble(col_names=Year, id_col="Year")

data <- left_join(data_1a, data_1b, by="Year") |> left_join(data_2, by="Year")
```

# Summary statistics

```{r}
glimpse(data)
```

# Graph

```{r}
ggplot(data) +
  geom_point(aes(x = vic_Cau+vic_Cas, y = sen_humsfty), alpha = 0.5) + 
#  geom_point(aes(x = vic_Cau+vic_Cas, y = sen_humsfty, size = att_SoR), alpha = 0.5) + 
  geom_text(aes(x = vic_Cau+vic_Cas, y = sen_humsfty, label = Year, vjust="bottom")) + 
  geom_smooth(aes(x = vic_Cau+vic_Cas, y = sen_humsfty), formula = y ~ log(x)) +
  labs(title = "Relationship between sentences for ethnic crime and victims in Russia",
       subtitle = "Data ponts are years",
       x = "Victims from SR",
       y = "Number of sentences") +
  theme_bw()
```


# Appendix

This command ensures that somebody at some later time can reproduce your analysis.

```{r}
sessionInfo()
```