---
title: "Change attitudes and organizational innovation and happiness in HR departments"
author: "Hamid Keshavarz"
date: "2022-03-07 (updated: `r Sys.Date()`)"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: 4
    toc_float: no
    code_folding: hide
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Background

This study tried to examine the effects of change attitudes of HR department (University of Tehran) on organizational innovation and happiness. The total population of the present study was 348 employees (HR departments) of the University of Tehran. 219 (62.9%) of the respondents were male and 129 (37.1%) were female. We also know about their duration of employment or work experience in years (`experience`).

The questionnaire items use a 5-level Likert scale from 1 to 5 (strongly disagree = 1, disagree = 2, have no opinion = 3, agree = 4 and strongly agree = 5).

**Independent variables:** Change attitudes of HR department (q01 to q18; AOCQ)

+ cognitive attitude (q01 to q06)
+ affective attitude (q07 to q12)
+ behavioral attitude (q13 to q18)

** Dependent variables**

+ organizational innovation (q19 to q26; Counter Innovative Behavior, 1998)
+ organizational staff happiness  (q27 to q49; Kjerulf, 2007)
    + learning (q27 to q30)
    + self-openness (q31 to q35)
    + participation (q36 to q38)
    + positive thinking (q39 to q42)
    + meaningful work (q43 to q45)
    + interesting work (q46 to q49)

Moreover, the questionnaire on organizational happiness suggests that if the staff think of their workplace as a learning environment in which they can positively participate in a meaningful interesting job, organizational happiness will take place.
# Setup

```{r}
library(tidyverse)
library(summarytools) # dfSummary(), descr(), freq()
library(psych)
library(performance)

# packages with additional graphics options
library(car)
library(GGally)
library(cowplot)
```

# Read the data

```{r}
data <- read_csv("data/Keshavarz_1_HR.csv")
spec(data)
#view(dfSummary(data))
descr(data, stats="common")  
glimpse(data)
```

# Preprocessing

## Basics

```{r}
dat <-
  data |> 
  mutate(Subj=as_factor(paste0("S", str_pad(1:348, width=3, side="left", pad="0"))),
         Gender = factor(Gender, levels=c(1,2), labels=c("male", "female"))) |> 
  relocate(Gender:experience, .after=Subj) 
```

## Scale statistics (Cronbach's alpha)

You need to `install.packages("psych")` for good scale statistics and more. 

### Change attitude

+ `alpha()`  computes Cronbach's alpha and lots of other statistics
+ `str(aocq)` shows you exactly all the results computed by `alpha()` 
+  with  `aocq$scores`  we extract the subjects' scores (and can store them in `dat`)

```{r}
aocq <- alpha(dat[,1:18], check.keys=TRUE)
aocq

str(aocq)
dat$aocq <- aocq$scores
```

We need to know the content of questions. It looks like `q06` and `q07` need to be inverted. Aside from this, the scale statistics look very good. 

**Cognitive**
+ q01: In general, change would reduce my ability to have control over what happens at work.
+ q02: I usually resist new thoughts and ideas.
+ q03: I do not like change.
+ q04: Change causes my failure.
+ q05: Most workplace changes bother me.
+ q06: Usually, I use new thoughts and ideas with hesitation.

**Affective**
+ q07: Change is useful for the organization.
+ q08: Most of my colleagues benefit from change.
+ q09: I do everything I can to support the change.
+ q10: Normally, I support new thoughts and ideas.
+ q11: I have found that most of the changes are pleasant.
+ q12: Normally, I have benefited from the change.

#### Cognition

```{r}
cor(dat[ ,1:6])

cog <- psych::alpha(dat[ ,1:6], check.keys=TRUE)
cog
dat$cog <- cog$scores
```

Looking good!

#### Affect

```{r}
cor(dat[ ,7:12])

aff <- psych::alpha(dat[ ,7:12], check.keys=TRUE)
aff
dat$aff <- aff$scores
```

A bit marginal, but still acceptable.

#### Behavior

```{r}
beh <- psych::alpha(dat[ ,13:18], check.keys=TRUE)
beh
dat$beh <- beh$scores
```

Looking good!

### Organizational innovation

```{r}
inno <- psych::alpha(dat[, 19:26], check.keys=TRUE)
inno
dat$inno <- inno$scores
```

Looking good!

### Organizational staff happiness

```{r}
hppy <- psych::alpha(dat[, 27:49], check.keys=TRUE)
hppy
dat$hppy <- hppy$scores
```

Looking good!

#### Learning (q27 to q30)

```{r}
lrn <- psych::alpha(dat[, 27:30], check.keys=TRUE)
lrn
dat$lrn <- lrn$scores
```

#### Self-openness (q31 to q35)

```{r}
sop <- psych::alpha(dat[, 31:35], check.keys=TRUE)
sop
dat$sop <- sop$scores
```

#### Participation (q36 to q38)

```{r}
prt <- psych::alpha(dat[, 36:38], check.keys=TRUE)
prt
dat$prt <- prt$scores
```

#### Positive thinking (q39 to q42)

```{r}
pth <- psych::alpha(dat[, 39:42], check.keys=TRUE)
pth
dat$pth <- pth$scores
```

#### Meaningful work (q43 to q45)

```{r}
mfw <- psych::alpha(dat[, 43:45], check.keys=TRUE)
mfw
dat$mwf <- mfw$scores
```

#### Interesting work (q46 to q49)

```{r}
wrk <- psych::alpha(dat[, 46:49], check.keys=TRUE)
wrk
dat$wrk <- wrk$scores
```

## Scale and subscale scores

Often we don't really need item level information anymore. Here we simple extract the subject information and the scale and subscale scores into the dataframe we are going to use fpr descriptive statistics in reports, figures, and as input to some inferential statistics.

```{r}
dat_w <- 
  dat |> 
  select(Subj, Gender, experience:wrk) |> 
  mutate(cog_c = cog - 3,
         aff_c = aff - 3,
         beh_c = beh - 3)
```

From the wide format, we may need to go to the long format.

# Theoretical question

1. Does organizational innovation depend on cognitive, affective, and behavioral change attitude?
2. Does organizational happiness depend on cognitive, affective, and behavioral change attitude?
3. Are these effects moderated by Gender?

# Method 1: Multiple regression

##  DV: innovation

### Inferential statistics

```{r}

m1_inno <- lm(inno ~ 1 + cog + aff + beh, data=dat_w)
summary(m1_inno)

contrasts(dat_w$Gender) <-  contr.sum(2)
m2_inno <- lm(inno ~ 1 +  cog + aff + beh + Gender, data=dat_w)
summary(m2_inno)

m3_inno <- lm(inno ~ 1 + (cog + aff + beh)*Gender, data=dat_w)
summary(m3_inno)

anova(m1_inno, m2_inno, m3_inno)
```

###  Visualization 

```{r}
# cognition
p_cog <- 
  dat_w |> 
  ggplot(aes(x=cog, y= inno, group=Gender, color=Gender)) +
  geom_jitter() + geom_smooth(method="lm") + 
  scale_color_manual("", values=c("blue", "red")) +
  scale_y_continuous("Rating of organization innovation",  breaks=1:5) +
  scale_x_continuous("Attitude to cognitive change",  breaks=1:5) +
  coord_fixed(ratio=1, xlim=c(1,5.5), ylim=c(1,5.5)) +
  theme_bw()
p_cog

m3_inno_cog <- lm(inno ~ 1 + cog*Gender, data=dat_w)
summary(m3_inno_cog)

# affect
p_aff <- 
  dat_w |> 
  ggplot(aes(x=aff, y= inno, group=Gender, color=Gender)) +
  geom_jitter() + geom_smooth(method="lm") + 
  scale_color_manual("", values=c("blue", "red")) +
  scale_y_continuous("Rating of organization innovation", breaks=1:5) +
  scale_x_continuous("Attitude to affective change", breaks=1:5) +
  coord_fixed(ratio=1, xlim=c(1,5.5), ylim=c(1,5.5)) +
  theme_bw()
p_aff

m3_inno_aff <- lm(inno ~ 1 + aff*Gender, data=dat_w)
summary(m3_inno_aff)

# behavior
p_beh <- 
  dat_w |> 
  ggplot(aes(x=beh, y= inno, group=Gender, color=Gender)) +
  geom_jitter() + geom_smooth(method="lm") + 
  scale_y_continuous("Rating of organization innovation", breaks=1:5) +
  scale_x_continuous("Attitude to behavioral change",  breaks=1:5) +
  scale_color_manual("", values=c("blue", "red")) +
  coord_fixed(ratio=1, xlim=c(1,5.5), ylim=c(1,5.5)) +
  theme_bw()
p_beh

m3_inno_beh <- lm(inno ~ 1 + beh*Gender, data=dat_w)
summary(m3_inno_beh)
```

The profile of significant effects in `m3_inno`  does not agree with the zero-order relations of these variables, that is when they are assessed independently of each other. This means when the three IVs are in the model they "interfere" with each other. They generate what is known as a suppressor constellation. Suppressor constellations often suggest that there may be an interaction lurking in the data. 

## Model explorations

### Visualizations

Let's look at the three plots at the same time. 

```{r}
dat_l |> 
  ggplot(aes(x=rating, y=inno, group=Gender, color=Gender)) +
  geom_jitter() + 
  geom_smooth(method="lm") +
  facet_grid(. ~ Attitude) +
  scale_color_manual("", values=c("blue", "red")) +
  theme_bw()
```

Let's look at scatterplot matrices

```{r}
dat_w |> 
  ggscatmat(columns = c("inno", "cog", "aff", "beh"), color = "Gender", alpha = 1) + 
  theme(legend.position="top", legend.title=element_blank()) +
  guides(colour = guide_legend(override.aes = list(size=3))) +
  scale_color_manual("", values=c("blue", "red")) + 
  theme_bw() + theme(legend.position = "top")

# an alternative with ellipses
scatterplotMatrix(~  inno + cog + aff + beh  | Gender, data=dat_w, 
                    smooth=FALSE, regLine=FALSE, ellipse=TRUE, legend = FALSE )
```


### Residuals

```{r}
check_model(m3_inno)


m3b_inno <- lm(inno ~ 1 + (cog_c + aff_c + beh_c)*Gender, data=dat_w)
summary(m3b_inno)

check_model(m3b_inno)
```

### Add interaction terms

```{r}
m4_inno <- lm(inno ~ 1 + cog_c + aff_c*beh_c, data=dat_w)
summary(m4_inno)

anova(m1_inno, m4_inno)

m5_inno <- lm(inno ~ 1 + cog_c + aff_c*(beh_c + Gender), 
              data=dat_w)
summary(m5_inno)

anova(m1_inno, m4_inno, m5_inno)
```

With the interaction between `aff` and `beh` in the model, `Gender` is no longer significant. Perhaps we have been looking at the wrong model.  

### Interaction of `aff` x `beh`

Let's visualize the `aff` x `beh` interaction.  

When two continuous variables interact, one option is to turn one of them into a factor and put it in the `group`. We convert all of three variables into factors.

There are three options

+ we let the program make groups with approx. equal range: `cut_interval()`
+ we let the program make groups with approx. equal n's of obs: `cut_number()`

Looking at the figure, it seems there are very few values below 3. Let's got with `cut_nunber()`.

```{r}
dat_w$CogN = cut_number(dat_w$cog, n=3)
dat_w$AffN = cut_number(dat_w$aff, n=3)
dat_w$BehN = cut_number(dat_w$beh, n=3)
dat_w$BehI = cut_interval(dat_w$beh, n=3)

# checks
dat_w |> group_by(BehN) |> summarise(N=n(), aff_M=mean(aff))
dat_w |> group_by(BehI) |> summarise(N=n(), aff_M=mean(aff))
```

And the graph:

```{r}
dat_w |> 
  ggplot(aes(x=aff, y=inno, group=BehN, color=BehN)) +
  geom_jitter() + geom_smooth(method="lm") + 
  scale_color_manual("Beh Bins", values = c("blue", "orange", "red")) +
  facet_grid(. ~ Gender) +
  theme_bw()

dat_w |> 
  ggplot(aes(x=beh, y=inno, group=AffN, color=AffN)) +
  geom_jitter() + geom_smooth(method="lm") + 
  scale_color_manual("Aff Bins", values = c("blue", "orange", "red")) +
  facet_grid(. ~ Gender) +
  theme_bw()

dat_w |> group_by(AffN, Gender) |> summarise(N=n(), aff_M=mean(aff))

# other variables?
dat_w |> group_by(BehN, Gender) |> summarise(N=n(), aff_M=mean(aff)) # ok
dat_w |> group_by(CogN, Gender) |> summarise(N=n(), aff_M=mean(aff)) # ok
```

Solution: Don't include `aff` now. Try to understand why male and female responded so differently.  Start over.


```{r}
m6_inno <- lm(inno ~ 1 + cog_c + beh_c, data=dat_w)
summary(m6_inno)

m7_inno <- lm(inno ~ 1 + (cog_c + beh_c)*Gender, data=dat_w)
summary(m8a_inno)

anova(m6_inno, m7_inno)

m8_inno <- lm(inno ~ 1 + cog_c*beh_c, data=dat_w)
summary(m8_inno)

anova(m6_inno,  m8b_inno)
```



```{r}
dat_w |> 
  ggplot(aes(x=beh, y=inno, group=CogN, color=CogN)) +
  geom_jitter() + geom_smooth(method="lm") + 
  scale_color_manual("Cog Bins", values = c("blue", "orange", "red")) +
  theme_bw()

check_model(m8_inno)
check_model(m6_inno)
```

# Method 2: Linear Mixed Model

```{r}
dat_l <- 
  dat_w |> 
  pivot_longer(cog:beh, names_to = "Attitude", values_to = "rating") |> 
  mutate(Attitude = factor(Attitude, levels=c("cog", "aff", "beh")),
         rating_c = rating - 3)
```

## Visualization

```{r}
dat_l |> 
  ggplot(aes(x=rating_c, y=inno, group=Gender, color=Gender)) +
  geom_jitter() + 
  geom_smooth(method="lm", formula=y~1+poly(x,3)) +
  facet_grid(. ~ Attitude) +
  theme_bw()
```

Improve this graph!

+ labels of axes
+ labels of facets
+ position of legend
+ remove legend header
+ color or points and line
+ linear regression (order 1, 2, 3)

# Appendix

This command ensures that somebody at some later time can reproduce your analysis.

```{r}
sessionInfo()
```