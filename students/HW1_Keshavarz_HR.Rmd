---
title: "Change attitudes and organizational innovation and happiness in HR departments"
author: "Hamid Keshavarz"
date: "2022-03-07 (updated: `r Sys.Date()`)"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: 4
    toc_float: no
    code_folding: hide
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Background

This study tried to examine the effects of change attitudes of HR department (University of Tehran) on organizational innovation and happiness. The total population of the present study was 348 employees (HR departments) of the University of Tehran. 219 (62.9%) of the respondents were male and 129 (37.1%) were female. We also know about their duration of employment or work experience in years (`experience`).

The questionnaire items use a 5-level Likert scale from 1 to 5 (strongly disagree = 1, disagree = 2, have no opinion = 3, agree = 4 and strongly agree = 5).

**Independent variables:** Change attitudes of HR department (q01 to q18; AOCQ)

+ cognitive attitude (q01 to q06)
+ affective attitude (q07 to q12)
+ behavioral attitude (q13 to q18)

** Dependent variables**

+ organizational innovation (q19 to q26; Counter Innovative Behavior, 1998)
+ organizational staff happiness  (q27 to q49; Kjerulf, 2007)
    + learning (q27 to q30)
    + self-openness (q31 to q35)
    + participation (q36 to q38)
    + positive thinking (q39 to q42)
    + meaningful work (q43 to q45)
    + interesting work (q46 to q49)

Moreover, the questionnaire on organizational happiness suggests that if the staff think of their workplace as a learning environment in which they can positively participate in a meaningful interesting job, organizational happiness will take place.
# Setup

```{r}
library(tidyverse)
library(summarytools) # dfSummary(), descr(), freq()
```

# Read the data

```{r}
data <- read_csv("data/Keshavarz_1_HR.csv")
spec(data)
#view(dfSummary(data))
descr(data, stats="common")  
glimpse(data)
```

# Preprocessing

## Basics

```{r}
dat <-
  data |> 
  mutate(Subj=as_factor(paste0("S", str_pad(1:348, width=3, side="left", pad="0"))),
         Gender = factor(Gender, levels=c(1,2), labels=c("male", "female"))) |> 
  relocate(Gender:experience, .after=Subj) 
```

## Scale statistics (Cronbach's alpha)

You need to `install.packages("psych")` for good scale statistics and more. 

### Change attitude

+ `alpha()`  computes Cronbach's alpha and lots of other statistics
+ `str(aocq)` shows you exactly all the results computed by `alpha()` 
+  with  `aocq$scores`  we extract the subjects' scores (and can store them in `dat`)

```{r}
library(psych)
aocq <- alpha(dat[,1:18], check.keys=TRUE)
aocq

str(aocq)
dat$aocq <- aocq$scores
```

We need to know the content of questions. It looks like `q06` and `q07` need to be inverted. Aside from this, the scale statistics look very good. 

#### Cognition

```{r}
cog <- psych::alpha(dat[ ,1:6], check.keys=TRUE)
cog
dat$cog <- cog$scores
```

Looking good!

#### Affect

```{r}
aff <- psych::alpha(dat[ ,7:12], check.keys=TRUE)
aff
dat$aff <- aff$scores
```

A bit marginal, but still acceptable.

#### Behavior

```{r}
beh <- psych::alpha(dat[ ,13:18], check.keys=TRUE)
beh
dat$beh <- beh$scores
```

Looking good!

### Organizational innovation

```{r}
inno <- psych::alpha(dat[, 19:26], check.keys=TRUE)
inno
dat$inno <- inno$scores
```

Looking good!

### Organizational staff happiness

```{r}
hppy <- psych::alpha(dat[, 27:49], check.keys=TRUE)
hppy
dat$hppy <- hppy$scores
```

Looking good!

#### Learning (q27 to q30)

```{r}
lrn <- psych::alpha(dat[, 27:30], check.keys=TRUE)
lrn
dat$lrn <- lrn$scores
```

#### Self-openness (q31 to q35)

```{r}
sop <- psych::alpha(dat[, 31:35], check.keys=TRUE)
sop
dat$sop <- sop$scores
```

#### Participation (q36 to q38)

```{r}
prt <- psych::alpha(dat[, 36:38], check.keys=TRUE)
prt
dat$prt <- prt$scores
```

#### Positive thinking (q39 to q42)

```{r}
pth <- psych::alpha(dat[, 39:42], check.keys=TRUE)
pth
dat$pth <- pth$scores
```

#### Meaningful work (q43 to q45)

```{r}
mfw <- psych::alpha(dat[, 43:45], check.keys=TRUE)
mfw
dat$mwf <- mfw$scores
```

#### Interesting work (q46 to q49)

```{r}
wrk <- psych::alpha(dat[, 46:49], check.keys=TRUE)
wrk
dat$wrk <- wrk$scores
```

## Scale and subscale scores

Often we don't really need item level information anymore. Here we simple extract the subject information and the scale and subscale scores into the dataframe we are going to use fpr descriptive statistics in reports, figures, and as input to some inferential statistics.

```{r}
dat_w <- dat |> select(Subj, Gender, experience:wrk)
```

From the wide format, we may need to go to the long format.

# Theoretical question

1. Does organizational innovation depend on cognitive, affective, and behavioral change attitude?
2. Does organizational happiness depend on cognitive, affective, and behavioral change attitude?
3. Are these effects moderated by Gender?

# Method: Multiple regression

##  DV: innovation

### Inferential statistics

```{r}
m1_inno <- lm(inno ~ 1 + cog + aff + beh, data=dat_w)
summary(m1_inno)

contrasts(dat_w$Gender) <-  contr.sum(2)
m2_inno <- lm(inno ~ 1 +  cog + aff + beh + Gender, data=dat_w)
summary(m2_inno)

m3_inno <- lm(inno ~ 1 + (cog + aff + beh)*Gender, data=dat_w)
summary(m3_inno)

anova(m1_inno, m2_inno, m3_inno)
```

###  Visualization 

```{r}
# cognition
dat_w |> 
  ggplot(aes(x=cog, y= inno, group=Gender, color=Gender)) +
  geom_jitter() + geom_smooth(method="lm") + 
  scale_color_manual("", values=c("blue", "red")) +
  scale_y_continuous("Rating of organization innovation",  breaks=1:5) +
  scale_x_continuous("Attitude to cognitive change",  breaks=1:5) +
  coord_fixed(ratio=1, xlim=c(1,5.5), ylim=c(1,5.5)) +
  theme_bw()

# affect
dat_w |> 
  ggplot(aes(x=aff, y= inno, group=Gender, color=Gender)) +
  geom_jitter() + geom_smooth(method="lm") + 
  scale_color_manual("", values=c("blue", "red")) +
  scale_y_continuous("Rating of organization innovation", breaks=1:5) +
  scale_x_continuous("Attitude to affective change", breaks=1:5) +
  coord_fixed(ratio=1, xlim=c(1,5.5), ylim=c(1,5.5)) +
  theme_bw()

# behavior
dat_w |> 
  ggplot(aes(x=beh, y= inno, group=Gender, color=Gender)) +
  geom_jitter() + geom_smooth(method="lm") + 
  scale_y_continuous("Rating of organization innovation", breaks=1:5) +
  scale_x_continuous("Attitude to behavioral change",  breaks=1:5) +
  scale_color_manual("", values=c("blue", "red")) +
  coord_fixed(ratio=1, xlim=c(1,5.5), ylim=c(1,5.5)) +
  theme_bw()

# combine three plots into a single once  <TO BE DONE>


```

## DV: happiness

### Inferential statistics

```{r}
m1_hppy <- lm(hppy ~ 1 + cog + aff + beh, data=dat_w)
summary(m1_hppy)
```

### Visualization

```{r}
# <TO BE DONE>

```


# Method: Linear Mixed Model

```{r}
dat_l <- 
  dat_w |> 
  pivot_longer(cog:beh, names_to = "Attitude", values_to = "rating") |> 
  mutate(Attitude = factor(Attitude, levels=c("cog", "aff", "beh")),
         rating_c = rating - 3)
```

## Visualization

```{r}
dat_l |> 
  ggplot(aes(x=rating_c, y=inno, group=Gender, color=Gender)) +
  geom_jitter() + 
  geom_smooth() +
  facet_grid(. ~ Attitude) +
  theme_bw()
```

Improve this graph!

+ labels of axes
+ labels of facets
+ position of legend
+ remove legend header
+ color or points and line
+ liner regression (order 1, 2, 3)

## Inferential statistics

```{r}

```

# Appendix

This command ensures that somebody at some later time can reproduce your analysis.

```{r}
sessionInfo()
```